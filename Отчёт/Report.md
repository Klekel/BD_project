# Проектная работа по дисциплине "Базы данных"

## ***<p style="text-align: center;">Тема проектной работы: База данных маршрутов электричек Зеленоград - Москва</p>***

#### Выполнил: студент группы ИВТ-41 Багров Александр

## Описание структуры базы данных

Данная база данных разработана для организации и предоставления пользователям удобного доступа к информации о расписании различных электричек. Обычный пользователь может получить доступ к базе данных через приложение, в котором у него будет возможность увидеть все необходимые маршруты.

Она может использоваться для:

- Управления расписанием поездов.

- Продажи билетов.

- Анализа маршрутов и станций.

Где и кем возможно использование

- *Железнодорожные компании*: Для управления перевозками, расписанием и продажей билетов.

- *Пользователи*: Для покупки билетов, просмотра расписания, выбора маршрутов.

- *Администраторы*: Для управления данными (добавление/изменение/удаление поездов, станций, маршрутов).

## Таблицы и ограничения

### Таблица `Trains`

| Название          | Тип данных       | Ограничения                                                                 |
|-------------------|------------------|-----------------------------------------------------------------------------|
| train_id          | SERIAL           | *Первичный ключ*                                                              |
| train_number      | VARCHAR(20)      | Не может быть пустым                                                        |
| type              | VARCHAR(20)      | Не может быть пустым, должно быть одним из: 'Ласточка', 'Комфорт', 'Обычная' |
| carriage_amount   | INT              | Не может быть пустым, должно быть больше 5 и не больше 12                    |

---

### Таблица `Stations`

| Название               | Тип данных       | Ограничения                                                                 |
|------------------------|------------------|-----------------------------------------------------------------------------|
| station_id             | SERIAL           | *Первичный ключ*                                                              |
| station_name           | VARCHAR(100)     | Не может быть пустым, должно быть уникальным                                 |
| station_location       | VARCHAR(200)     | Не может быть пустым, должно быть уникальным                                 |
| train_platform_amount  | INT              | Не может быть пустым, должно быть не больше 10                               |
| self_checkout          | BOOLEAN          | Не может быть пустым                                                        |

---

### Таблица `Routes`

| Название          | Тип данных       | Ограничения                                                                 |
|-------------------|------------------|-----------------------------------------------------------------------------|
| route_id          | SERIAL           | *Первичный ключ*                                                              |
| start_station_id  | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Stations.station_id`       |
| end_station_id    | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Stations.station_id`       |
| estimated_time    | INTERVAL         | Не может быть пустым                                                        |
| description       | TEXT             | Не может быть пустым                                                        |

**Ограничения:**
- `start_station_id` и `end_station_id` не могут быть одинаковыми.

---

### Таблица `RouteStations`

| Название               | Тип данных       | Ограничения                                                                 |
|------------------------|------------------|-----------------------------------------------------------------------------|
| routestation_id        | SERIAL           | *Первичный ключ*                                                              |
| route_id               | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Routes.route_id`           |
| station_id             | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Stations.station_id`       |
| station_order          | INT              | Не может быть пустым                                                        |
| price_to_next_station  | DECIMAL(10, 2)   | Не может быть пустым, должно быть больше или равно 0                         |

---

### Таблица `Schedule`

| Название          | Тип данных       | Ограничения                                                                 |
|-------------------|------------------|-----------------------------------------------------------------------------|
| schedule_id       | SERIAL           | *Первичный ключ*                                                              |
| train_id          | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Trains.train_id`           |
| route_id          | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Routes.route_id`           |
| departure_time    | INTERVAL         | -                                                                           |
| arrival_time      | INTERVAL         | -                                                                           |
| station_id        | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Stations.station_id`       |

---

### Таблица `Users`

| Название               | Тип данных       | Ограничения                                                                 |
|------------------------|------------------|-----------------------------------------------------------------------------|
| user_id                | SERIAL           | *Первичный ключ*                                                              |
| first_name             | VARCHAR(50)      | Не может быть пустым                                                        |
| last_name              | VARCHAR(50)      | Не может быть пустым                                                        |
| mail                   | VARCHAR(100)     | Не может быть пустым, должно быть уникальным, соответствовать формату email   |
| phone_number           | VARCHAR(15)      | Не может быть пустым, должно быть уникальным, соответствовать формату телефона ( `x-xxx-xxx-xx-xx` )|
| date_of_reg            | DATE             | Не может быть пустым, по умолчанию текущая дата                              |
| money                  | DECIMAL(15, 2)   | Не может быть пустым, должно быть больше или равно 0                         |
| transport_concession   | VARCHAR(20)      | Не может быть пустым, должно быть одним из: 'без льгот', 'пол цены', 'бесплатно' |

---

### Таблица `Tickets`

| Название          | Тип данных       | Ограничения                                                                 |
|-------------------|------------------|-----------------------------------------------------------------------------|
| ticket_id         | SERIAL           | *Первичный ключ*                                                              |
| user_id           | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Users.user_id`             |
| route_id          | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Routes.route_id`           |
| from_station_id   | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Stations.station_id`       |
| to_station_id     | INT              | Не может быть пустым, *внешний ключ*, ссылается на `Stations.station_id`       |
| date              | DATE             | Не может быть пустым                                                        |
| price             | DECIMAL(10, 2)   | Не может быть пустым, должно быть больше или равно 0, по умолчанию 0         |
| total_price       | DECIMAL(10, 2)   | Не может быть пустым, должно быть больше или равно 0, по умолчанию 0         |
| train_type        | VARCHAR(20)      | Не может быть пустым, должно быть одним из: 'Ласточка', 'Комфорт', 'Обычная'  |

- `from_station_id` и `to_station_id` не могут быть одинаковыми.

## Схема базы данных

![alt text](image.png)

## Список созданных запросов

1. Расписание для каждой станции с выводом типа электрички и направления (конечной станции маршрута)
2. Выборка людей зарегестрировавшихся в последние 30 дней
3. Поиск электричек с количеством вагонов меньше 10
4. Выборка всех станций где есть кассы самообслуживания
5. Вывод всех билетов с учётом льгот пользователей
6. Вывод всех станций определённого маршрута
7. Вывод информации о пользователях потративших на билеты больше 100 рублей
8. Вывод всех пользователей с почтовым доменом @mail.ru
9. Вывод всех билетов на определённую дату
10. Получение информации о станциях с указанием количества поездов, которые через них проходят
11. Выборка маршрутов которые длятся больше часа
12. Получить общее количество пользователей
13. Общая выручка от продажи билетов
14. Выводит все маршруты в которых присутствует данная станция
15. Выведет самый длинный маршрут по времени
16. Вывод маршрута с самым большим количеством станций
17. Выводит количество бидетов для каждого типа электричек
18. Выводит топ 3 маршрута по количеству проданных билетов
19. Вывести пользователей, которые купили билеты на маршруты с ценой выше средней
20. Вывести станции, которые не используются ни в одном маршруте

## Список функций и тригеров

1. Функция: `update_user_money`() Триггер: `ticket_purchase_trigger`

    *Описание*: Функция вызывается триггером при вставке новой записи в таблицу Tickets. Она обновляет баланс пользователя, вычитая стоимость билета (total_price) из его баланса. Если баланс становится отрицательным, выбрасывается исключение.

2. Функция: `get_train_schedule_with_price_2`(p_from_station_id, p_to_station_id, p_user_id) Возвращаемый тип данных `Schedule_table_new`

    *Описание*: Функция возвращает расписание поездов между двумя станциями (from_station_id и to_station_id), включая номер поезда, тип поезда, время отправления, время прибытия, название  станции, идентификатор маршрута и общую стоимость билета.

3. Функция: `name_to_id`(station_name_in)

    *Описание*: Функция преобразует название станции (station_name_in) в её идентификатор (station_id).

4. Функция: `calculate_ticket_price`() Триггер: `trigger_calculate_ticket_price`

    *Описание*: Функция вычисляет стоимость билета на основе маршрута, станций отправления и назначения, а также льгот пользователя. Результат записывается в поля price и total_price новой записи в таблице Tickets.

## Список созданных процедур с описанием

1. `add_user`(*p_first_name, p_last_name, p_mail, p_phone_number, p_money, p_user_password, p_transport_concession*)

    *Описание*: Процедура добавляет нового пользователя в таблицу Users.

2. `change_users_money`(*p_user_id, p_money*)

    *Описание*: Процедура изменяет баланс пользователя в таблице Users.

3. `add_route`(*p_start_station_id, p_end_station_id, p_estimated_time, p_description*)

    *Описание*: Процедура добавляет новый маршрут в таблицу Routes.

4. `delete_route`(*p_route_id*)

    *Описание*: Процедура удаляет маршрут из таблицы Routes.

5. `add_ticket`(*p_user_id, p_route_id, p_from_station_id, p_to_station_id, p_train_type, p_date*)

    *Описание*: Процедура добавляет новый билет в таблицу Tickets.

## Оптимизация с помощью индексов

Поле `route_id` используется в запросах, связанных с расписанием и маршрутами. Создание индекса на этом столбце ускорит выполнение запросов, связанных с маршрутами. Поля, которые используются в операциях JOIN, должны быть проиндексированы для ускорения выполнения соединений.

```sql
 CREATE INDEX idx_routestations_route_id ON RouteStations(route_id);
 ```

Для столбца `station_id` в таблице RouteStations можно создать индекс, так как это поле часто используется в запросах, особенно в операциях JOIN и WHERE

```sql
CREATE INDEX idx_routestations_station_id ON RouteStations(station_id);
```

## Описание работы с графическим интерфейсом

Основные функции и окна:

  Окно авторизации:

   - Пользователь вводит email и пароль для входа в систему.

   - Если учетные данные верны, пользователь переходит в окно расписания.

   - Если учетные данные неверны, выводится сообщение об ошибке.

   - Есть возможность перейти к окну регистрации.

  Окно регистрации:

   - Пользователь заполняет форму с данными: имя, фамилия, email, номер телефона, льгота, пароль.

   - После успешной регистрации пользователь переходит в окно расписания.

   - Если возникает ошибка, выводится сообщение об ошибке.

  Окно расписания и покупки билетов:

   - Пользователь может выбрать станцию отправления и назначения.

   - После выбора станций отображается расписание поездов с информацией о номере поезда, типе электрички, времени отправления, времени прибытия, названии станции, номере маршрута и стоимости билета.

   - Пользователь может выбрать поезд из списка и купить билет.

   - Есть кнопка для перехода в личный кабинет.

  Окно личного кабинета:

   - Отображается информация о пользователе: имя, фамилия, баланс.

   - Пользователь может пополнить баланс, удалить аккаунт, просмотреть купленные билеты.

   - Есть возможность вернуться в окно расписания.

## Приложение

***<p style="text-align: center;">Создание таблиц со всеми ограничениями</p>***

Так как в процессе работы с базой данных я появлялась необходимость в некоторых атрибутах, в коде присутствуеют запросы для изменения таблиц

``` SQL
-- Создание таблицы Trains
CREATE TABLE Trains (
    train_id SERIAL PRIMARY KEY,
    train_number VARCHAR(20) NOT NULL,
    type VARCHAR(20) NOT NULL CHECK (type IN ('Ласточка', 'Комфорт', 'Обычная')),
    carriage_amount INT NOT NULL CHECK (carriage_amount > 5 AND carriage_amount <= 12)
);

-- Создание таблицы Stations
CREATE TABLE Stations (
    station_id SERIAL PRIMARY KEY,
    station_name VARCHAR(100) NOT NULL UNIQUE,
    station_location VARCHAR(200) NOT NULL UNIQUE,
    train_platform_amount INT NOT NULL CHECK (train_platform_amount <= 10),
    self_checkout BOOLEAN NOT NULL
);

-- Создание таблицы Routes
CREATE TABLE Routes (
    route_id SERIAL PRIMARY KEY,
    start_station_id INT NOT NULL,
    end_station_id INT NOT NULL,
    estimated_time INTERVAL NOT NULL,
    description TEXT NOT NULL,
    CONSTRAINT fk_start_station FOREIGN KEY (start_station_id) REFERENCES Stations (station_id),
    CONSTRAINT fk_end_station FOREIGN KEY (end_station_id) REFERENCES Stations (station_id),
    CONSTRAINT chk_start_end_station CHECK (start_station_id <> end_station_id)
);


-- Создание таблицы RouteStations
CREATE TABLE RouteStations (
    routestation_id SERIAL PRIMARY KEY,
    route_id INT NOT NULL,
    station_id INT NOT NULL,
    station_order INT NOT NULL,
    price_to_next_station DECIMAL(10, 2) NOT NULL CHECK (price_to_next_station >= 0),
    CONSTRAINT fk_route FOREIGN KEY (route_id) REFERENCES Routes (route_id),
    CONSTRAINT fk_station FOREIGN KEY (station_id) REFERENCES Stations (station_id),
);

ALter table RouteStations
ADD constraint routestations_price_to_next_station_check CHECK (price_to_next_station >= 0);


-- Создание таблицы Schedule
CREATE TABLE Schedule (
    schedule_id SERIAL PRIMARY KEY,
    train_id INT NOT NULL,
    route_id INT NOT NULL,
    departure_time INTERVAL,
    arrival_time INTERVAL,
    station_id INT NOT NULL,
    CONSTRAINT fk_station FOREIGN KEY (station_id) REFERENCES Stations (station_id),
    CONSTRAINT fk_train FOREIGN KEY (train_id) REFERENCES Trains (train_id),
    CONSTRAINT fk_route_schedule FOREIGN KEY (route_id) REFERENCES Routes (route_id)
);

-- Создание таблицы User
CREATE TABLE Users (
    user_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    mail VARCHAR(100) NOT NULL UNIQUE CHECK (mail ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'),
    phone_number VARCHAR(15) NOT NULL UNIQUE CHECK (phone_number ~* '^\d-\d{3}-\d{3}-\d{2}-\d{2}$'),
    date_of_reg DATE NOT NULL DEFAULT CURRENT_DATE,
    money DECIMAL(15, 2) NOT NULL CHECK (money >= 0),
    transport_concession VARCHAR(20) NOT NULL CHECK (transport_concession IN ('без льгот', 'пол цены', 'бесплатно'))
);

-- Создание таблицы Tickets
CREATE TABLE Tickets (
    ticket_id SERIAL PRIMARY KEY,
    user_id INT NOT NULL,
    route_id INT NOT NULL,
    from_station_id INT NOT NULL,
    to_station_id INT NOT NULL,
    date DATE NOT NULL,
    price DECIMAL(10, 2) NOT NULL DEFAULT 0 CHECK (price >= 0),
    total_price DECIMAL(10, 2) NOT NULL DEFAULT 0 CHECK (total_price >= 0),
    train_type VARCHAR(20) NOT NULL CHECK (train_type IN ('Ласточка', 'Комфорт', 'Обычная')),
    CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES Users (user_id),
    CONSTRAINT fk_route FOREIGN KEY (route_id) REFERENCES Routes (route_id),
    CONSTRAINT fk_from_station FOREIGN KEY (from_station_id) REFERENCES Stations (station_id),
    CONSTRAINT fk_to_station FOREIGN KEY (to_station_id) REFERENCES Stations (station_id),
    CONSTRAINT chk_from_to_station CHECK (from_station_id <> to_station_id)
);

```

***<p style="text-align: center;">Создание функций и триггеров</p>***

```SQL

-- Создал свой тип данных что бы функция могла выводить несколько столбцов данных

CREATE TYPE Schedule_table_new AS(
train_number varchar(20),
type varchar(20),
departure_time INTERVAL,
arrival_time INTERVAL,
station_name VARCHAR(100),
route_id INTEGER,
summa DECIMAL);

-- 1 функция

CREATE OR REPLACE FUNCTION get_train_schedule_with_price_2(
    p_from_station_id INT,
    p_to_station_id INT,
    p_user_id INT
)
RETURNS TABLE (
    train_number VARCHAR(20),
    train_type VARCHAR(20),
    departure_time INTERVAL,
    arrival_time INTERVAL,
    station_name VARCHAR(100),
    route_id INT,
    total_price DECIMAL(10, 2)
)
LANGUAGE plpgsql
AS $$
DECLARE
    concession_type VARCHAR(20);
BEGIN
    SELECT transport_concession INTO concession_type
    FROM Users
    WHERE user_id = p_user_id;

    RETURN QUERY
    SELECT
        tr.train_number,
        tr.type AS train_type,
        sc.departure_time,
        sc2.arrival_time,
        st.station_name,
        sc.route_id,
        (CASE
            WHEN concession_type = 'бесплатно' THEN 0
            WHEN concession_type = 'пол цены' THEN (SUM(rs.price_to_next_station) / 2)
            ELSE SUM(rs.price_to_next_station)
        END * CASE
            WHEN tr.type = 'Ласточка' THEN 2
            ELSE 1
        END) AS total_price
    FROM Schedule sc
    LEFT JOIN Trains tr ON tr.train_id = sc.train_id
    LEFT JOIN Stations st ON st.station_id = sc.station_id
    LEFT JOIN Schedule sc2 ON sc2.train_id = sc.train_id AND sc2.station_id = p_to_station_id
    LEFT JOIN RouteStations rs ON rs.route_id = sc.route_id
    WHERE sc.route_id IN (
            SELECT rs1.route_id
            FROM RouteStations rs1
            JOIN RouteStations rs2 ON rs1.route_id = rs2.route_id
            WHERE rs1.station_id = p_from_station_id
              AND rs2.station_id = p_to_station_id
        )
        AND sc.station_id = p_from_station_id
        AND sc.departure_time IS NOT NULL
        AND rs.station_order >= (
            SELECT rs1.station_order
            FROM RouteStations rs1
            WHERE rs1.station_id = p_from_station_id
              AND rs1.route_id = sc.route_id
        )
        AND rs.station_order < (
            SELECT rs2.station_order
            FROM RouteStations rs2
            WHERE rs2.station_id = p_to_station_id
              AND rs2.route_id = sc.route_id
        )
    GROUP BY
        tr.train_number, tr.type, sc.departure_time, sc2.arrival_time, st.station_name, sc.route_id;
END;
$$;

-- 2 функция

CREATE OR REPLACE FUNCTION name_to_id(station_name_in VARCHAR(100)) RETURNS INT
LANGUAGE SQL
AS $$
Select station_id FROM stations where station_name = station_name_in
$$;

-- 3 функция

CREATE OR REPLACE FUNCTION update_user_money()
RETURNS TRIGGER AS $$
BEGIN
    UPDATE Users
    SET money = money - NEW.total_price * ()
    WHERE user_id = NEW.user_id;

    IF (SELECT money FROM Users WHERE user_id = NEW.user_id) < 0 THEN
        RAISE EXCEPTION 'Недостаточно средств на счете пользователя с ID %', NEW.user_id;
    END IF;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- триггер вызывающий функцию update_user_money() при вводе новой строки в таблице Tickets

CREATE TRIGGER ticket_purchase_trigger
AFTER INSERT ON Tickets
FOR EACH ROW
EXECUTE FUNCTION update_user_money();

-- 4 функция

CREATE OR REPLACE FUNCTION calculate_ticket_price()
RETURNS TRIGGER AS $$
DECLARE
    calculated_price DECIMAL;
    concession_factor DECIMAL := 1.0;
BEGIN

    SELECT
        SUM(rs.price_to_next_station)
    INTO
        calculated_price
    FROM
        RouteStations rs
    WHERE
        rs.route_id = NEW.route_id
        AND rs.station_order >= (
            SELECT station_order
            FROM RouteStations
            WHERE station_id = NEW.from_station_id
            AND route_id = NEW.route_id
        )
        AND rs.station_order < (
            SELECT station_order
            FROM RouteStations
            WHERE station_id = NEW.to_station_id
            AND route_id = NEW.route_id
        );

    NEW.price := calculated_price;

    SELECT
        CASE
            WHEN u.transport_concession = 'пол цены' THEN 0.5
            WHEN u.transport_concession = 'бесплатно' THEN 0.0
            ELSE 1.0
        END
    INTO
        concession_factor
    FROM
        Users u
    WHERE
        u.user_id = NEW.user_id;

    IF NEW.train_type = 'Ласточка' THEN
        NEW.total_price := concession_factor * NEW.price * 2;
    ELSE
        NEW.total_price := concession_factor * NEW.price;
    END IF;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- триггер вызывающий функцию calculate_ticket_price()

CREATE TRIGGER trigger_calculate_ticket_price
BEFORE INSERT OR UPDATE ON Tickets
FOR EACH ROW
EXECUTE FUNCTION calculate_ticket_price();

```

***<p style="text-align: center;">Создание процедур</p>***

```SQL

-- 1 процедура

CREATE OR REPLACE PROCEDURE add_user(
    p_first_name VARCHAR(50),
    p_last_name VARCHAR(50),
    p_mail VARCHAR(100),
    p_phone_number VARCHAR(15),
    p_money numeric(15,2),
    p_user_password VARCHAR(255),
    p_transport_concession VARCHAR(20)
)
LANGUAGE plpgsql
AS $$
BEGIN
    INSERT INTO Users (first_name, last_name, mail, phone_number,money, user_password, transport_concession)
    VALUES (p_first_name, p_last_name, p_mail, p_phone_number, p_money, p_user_password, p_transport_concession);
END;
$$

-- 2 процедура

CREATE OR REPLACE PROCEDURE change_users_money(
  p_user_id INT,
  p_money numeric(15,2)
)
LANGUAGE plpgsql
AS $$
BEGIN
    UPDATE Users
    SET money = p_money
  WHERE user_id = p_user_id;

  IF NOT FOUND THEN
        RAISE NOTICE 'Пользователь с user_id = % не найден.', p_user_id;
    ELSE
        RAISE NOTICE 'Счёт пользователя с user_id = % умпешно изменён.', p_user_id;
    END IF;
END;
$$

-- 3 процедура

CREATE OR REPLACE PROCEDURE add_route(
    p_start_station_id INT,
    p_end_station_id INT,
    p_estimated_time INTERVAL,
    p_description TEXT
)
LANGUAGE plpgsql
AS $$
BEGIN
    INSERT INTO Routes (start_station_id, end_station_id, estimated_time, description)
    VALUES (p_start_station_id, p_end_station_id, p_estimated_time, p_description);
END;
$$

-- 4 процедура

CREATE OR REPLACE PROCEDURE delete_route(p_route_id INT)
LANGUAGE plpgsql
AS $$
BEGIN
    DELETE FROM Routes
    WHERE route_id = p_route_id;

    IF NOT FOUND THEN
        RAISE NOTICE 'Маршрут с route_id = % не найден.', p_route_id;
    ELSE
        RAISE NOTICE 'Маршрут с route_id = % успешно удален.', p_route_id;
    END IF;
END;
$$;

-- 5 процедура

CREATE OR REPLACE PROCEDURE add_ticket(
  p_user_id INT,
  p_route_id INT,
  p_from_station_id INT,
  p_to_station_id INT,
  p_train_type VARCHAR(20),
  p_date date
)
LANGUAGE plpgsql
AS $$
BEGIN
    INSERT INTO Tickets (user_id, route_id, from_station_id, to_station_id,train_type, date)
    VALUES (p_user_id, p_route_id, p_from_station_id, p_to_station_id, p_train_type, p_date);
END;
$$

```

***<p style="text-align: center;">Заполнения таблиц данными</p>***

```SQL

-- таблица поездов

INSERT INTO Trains (train_number, type, carriage_amount)
VALUES
    ('6503', 'Комфорт', 10),
    ('6501', 'Комфорт', 10),
    ('6301', 'Комфорт', 10),
    ('6701', 'Обычная', 8),
    ('6505', 'Комфорт', 10),
    ('6402', 'Комфорт', 10),
    ('7901', 'Ласточка', 10),
    ('7922', 'Ласточка', 10),
    ('6502', 'Комфорт', 10),
    ('6802', 'Комфорт', 10);

-- таблица расписаний


INSERT INTO Schedule (train_id, route_id, station_id, departure_time,arrival_time)
VALUES
	-- Маршрут 1: Зеленоград-Крюково -> Москва Ленинградская (комфорт)
  (1, 1, 1,  '04:47:00',  NULL),
	(1, 1, 24, '04:56:00', '04:55:00'),
	(1, 1, 25, '05:00:00', '04:59:00'),
	(1, 1, 26, '05:03:00', '05:02:00'),
	(1, 1, 27, '05:05:00', '05:04:00'),
	(1, 1, 28, '05:08:00', '05:07:00'),
  (1, 1, 29, '05:14:00', '05:14:00'),
	(1, 1, 30, '05:17:00', '05:17:00'),
  (1, 1, 31, '05:19:00', '05:18:00'),
	(1, 1, 32, '05:22:00', '05:22:00'),
  (1, 1, 33, '05:25:00', '05:24:00'),
  (1, 1, 34, '05:28:00', '05:27:00'),
	(1, 1, 35, '05:32:00', '05:32:00'),
	(1, 1, 36, '05:37:00', '05:36:00'),
	(1, 1, 38,  NULL     , '05:50:00'),

  -- Маршрут 2: Клин -> Москва Ленинградская (комфорт)
  (2, 2, 12, '03:30:00',  NULL),
	(2, 2, 39, '03:39:00', '03:38:00'),
	(2, 2, 14, '03:44:00', '03:43:00'),
	(2, 2, 15, '03:48:00', '03:47:00'),
	(2, 2, 16, '03:52:00', '03:51:00'),
	(2, 2, 17, '03:55:00', '03:54:00'),
	(2, 2, 18, '04:02:00', '04:01:00'),
	(2, 2, 19, '04:06:00', '04:05:00'),
	(2, 2, 20, '04:08:00', '04:07:00'),
	(2, 2, 21, '04:12:00', '04:11:00'),
	(2, 2, 1,  '04:20:00', '04:19:00'),
	(2, 2, 24, '04:29:00', '04:28:00'),
	(2, 2, 25, '04:33:00', '04:32:00'),
  (2, 2, 26, '04:36:00', '04:35:00'),
  (2, 2, 27, '04:39:00', '04:38:00'),
  (2, 2, 28, '04:41:00', '04:40:00'),
  (2, 2, 29, '04:46:00', '04:45:00'),
  (2, 2, 30, '04:49:00', '04:48:00'),
  (2, 2, 38,  NULL     , '05:11:00'),

    -- Маршрут 3: Зеленоград-Крюково -> Москва Ленинградская (комфорт)
  (3, 3, 1,  '04:12:00',  NULL),
  (3, 3, 25, '04:21:00', '04:20:00'),
  (3, 3, 29, '04:30:00', '04:29:00'),
  (3, 3, 38,  NULL     , '04:47:00'),

    -- Маршрут 4: Тверь -> Москва Ленинградская (Пригородный)

	(4, 4, 2,  '04:14:00',  NULL),
	(4, 4, 3,  '04:24:00', '04:23:00'),
	(4, 4, 4,  '04:30:00', '04:29:00'),
	(4, 4, 5,  '04:35:00', '04:34:00'),
	(4, 4, 6,  '04:41:00', '04:40:00'),
	(4, 4, 7,  '04:45:00', '04:44:00'),
	(4, 4, 8,  '04:52:00', '04:51:00'),
	(4, 4, 9,  '04:58:00', '04:57:00'),
	(4, 4, 10, '05:03:00', '05:02:00'),
	(4, 4, 11, '05:09:00', '05:08:00'),
	(4, 4, 12, '05:16:00', '05:15:00'),
	(4, 4, 13, '05:20:00', '05:19:00'),
  (4, 4, 39, '05:24:00', '05:23:00'),
	(4, 4, 14, '05:29:00', '05:28:00'),
	(4, 4, 15, '05:33:00', '05:32:00'),
	(4, 4, 16, '05:37:00', '05:36:00'),
	(4, 4, 17, '05:41:00', '05:40:00'),
	(4, 4, 18, '05:48:00', '05:47:00'),
	(4, 4, 19, '05:52:00', '05:51:00'),
	(4, 4, 20, '05:55:00', '05:54:00'),
	(4, 4, 21, '05:59:00', '05:58:00'),
	(4, 4, 1,  '06:07:00', '06:06:00'),
	(4, 4, 24, '06:16:00', '06:15:00'),
	(4, 4, 25, '06:20:00', '06:19:00'),
	(4, 4, 26, '06:23:00', '06:22:00'),
	(4, 4, 27, '06:25:00', '06:24:00'),
	(4, 4, 28, '06:28:00', '06:27:00'),
	(4, 4, 29, '06:34:00', '06:33:00'),
	(4, 4, 30, '06:37:00', '06:36:00'),
	(4, 4, 31, '06:39:00', '06:38:00'),
	(4, 4, 32, '06:42:00', '06:41:00'),
	(4, 4, 33, '06:45:00', '06:44:00'),
	(4, 4, 34, '06:48:00', '06:47:00'),
	(4, 4, 35, '06:52:00', '06:51:00'),
	(4, 4, 36, '06:57:00', '06:56:00'),
	(4, 4, 38,  NULL     , '07:10:00'),

  -- Маршрут 5: Клин -> Москва Ленинградская (комфорт)
	(5, 5, 12,'04:34:00',  NULL),
	(5, 5, 13,'04:41:00','04:40:00' ),
	(5, 5, 39,'04:45:00','04:44:00' ),
	(5, 5, 14,'04:50:00','04:49:00' ),
	(5, 5, 15,'04:54:00','04:53:00' ),
	(5, 5, 16,'04:58:00','04:57:00' ),
	(5, 5, 17,'05:01:00','05:00:00' ),
	(5, 5, 18,'05:09:00','05:08:00' ),
	(5, 5, 19,'05:13:00','05:12:00' ),
	(5, 5, 20,'05:16:00','05:15:00' ),
	(5, 5, 1, '05:27:00','05:26:00' ),
	(5, 5, 24,'05:36:00','05:35:00' ),
	(5, 5, 25,'05:40:00','05:39:00' ),
	(5, 5, 26,'05:43:00','05:42:00' ),
	(5, 5, 27,'05:45:00','05:44:00' ),
	(5, 5, 28,'05:48:00','05:47:00' ),
	(5, 5, 29,'05:54:00','05:53:00' ),
	(5, 5, 30,'05:57:00','05:56:00' ),
	(5, 5, 31,'05:59:00','05:58:00' ),
	(5, 5, 32,'06:02:00','06:01:00' ),
	(5, 5, 32,'06:05:00','06:04:00' ),
	(5, 5, 33,'06:08:00','06:07:00' ),
	(5, 5, 34,'06:12:00','06:11:00' ),
	(5, 5, 35,'06:17:00','06:16:00' ),
	(5, 5, 36,'06:19:00','06:18:00' ),
	(5, 5, 38, NULL     ,'06:34:00'),

  -- Маршрут 6: Москва Ленинградская -> Подсолнечное (Комфорт)
  (6, 6, 38, '06:57:00', NULL),
	(6, 6, 36, '07:07:00','07:06:00'),
	(6, 6, 35, '07:10:00','07:09:00'),
	(6, 6, 34, '07:13:00','07:12:00'),
	(6, 6, 33, '07:16:00','07:15:00'),
	(6, 6, 32, '07:19:00','07:18:00'),
	(6, 6, 31, '07:22:00','07:21:00'),
	(6, 6, 30, '07:24:00','07:23:00'),
	(6, 6, 29, '07:27:00','07:26:00'),
	(6, 6, 28, '07:33:00','07:32:00'),
	(6, 6, 27, '07:36:00','07:35:00'),
	(6, 6, 26, '07:39:00','07:38:00'),
	(6, 6, 25, '07:42:00','07:41:00'),
	(6, 6, 24, '07:46:00','07:45:00'),
	(6, 6, 1,  '07:56:00','07:55:00'),
	(6, 6, 22, '08:00:00','07:59:00'),
	(6, 6, 21, '08:04:00','08:03:00'),
	(6, 6, 20, '08:08:00','08:07:00'),
  (6, 6, 19, '08:11:00','08:10:00'),
  (6, 6, 18, '08:15:00','08:14:00'),
  (6, 6, 17, NULL      ,'07:17:00'),

	-- Маршрут 7: Клин -> Москва Ленинградская (Ласточка)
	(7, 7, 12, '06:27:00', NULL),
	(7, 7, 17, '06:40:00','06:39:00'),
	(7, 7, 19, '06:48:00','06:47:00'),
	(7, 7, 1,  '06:56:00','06:55:00'),
	(7, 7, 25, '07:04:00','07:03:00'),
	(7, 7, 29, '07:13:00','07:12:00'),
	(7, 7, 38,  NULL     ,'07:30:00'),

	-- Маршрут 8: Москва Ленинградская -> Тверь (Ласточка)
	(8, 8, 38, '05:04:00', '05:03:00' ),
	(8, 8, 29, '05:19:00', '05:18:00' ),
	(8, 8, 25, '05:27:00', '05:26:00' ),
	(8, 8, 1,  '05:33:00', '05:32:00' ),
	(8, 8, 17, '05:46:00', '05:45:00' ),
	(8, 8, 12, '06:01:00', '06:00:00' ),
	(8, 8, 10, '06:10:00', '06:09:00' ),
	(8, 8, 8,  '06:19:00', '06:18:00' ),
	(8, 8, 6,  '06:27:00', '06:26:00' ),
	(8, 8, 3,  '06:38:00', '06:37:00' ),
	(8, 8, 2,   NULL     , '06:47:00' ),

	-- Маршрут 9: Москва Ленинградская -> Клин (Комфорт)
	(9, 9, 38, '04:27:00',  NULL),
	(9, 9, 29, '04:46:00', '04:45:00'),
	(9, 9, 25, '04:55:00', '04:54:00'),
	(9, 9, 1,  '05:04:00', '05:03:00'),
	(9, 9, 22, '05:08:00', '05:07:00'),
	(9, 9, 20, '05:14:00', '05:13:00'),
	(9, 9, 19, '05:17:00', '05:16:00'),
	(9, 9, 18, '05:21:00', '05:20:00'),
	(9, 9, 17, '05:28:00', '05:27:00'),
	(9, 9, 16, '05:31:00', '05:30:00'),
	(9, 9, 15, '05:35:00', '05:34:00'),
	(9, 9, 14, '05:39:00', '05:38:00'),
	(9, 9, 39, '05:45:00', '05:44:00'),
	(9, 9, 13, '05:49:00', '05:48:00'),
	(9, 9, 12,  NULL     , '05:56:00'),

	-- Маршрут 10: Москва Ленинградская -> Зеленоград-Крюково (Комфорт)
	(10, 10, 38, '00:17:00',  NULL),
	(10, 10, 36, '00:27:00', '00:26:00'),
	(10, 10, 35, '00:30:00', '00:29:00'),
	(10, 10, 34, '00:33:00', '00:32:00'),
	(10, 10, 33, '00:36:00', '00:35:00'),
	(10, 10, 32, '00:39:00', '00:38:00'),
	(10, 10, 31, '00:42:00', '00:41:00'),
	(10, 10, 30, '00:44:00', '00:43:00'),
	(10, 10, 29, '00:47:00', '00:48:00'),
	(10, 10, 28, '00:53:00', '00:52:00'),
	(10, 10, 27, '00:56:00', '00:55:00'),
	(10, 10, 26, '00:59:00', '00:58:00'),
	(10, 10, 25, '01:02:00', '01:01:00'),
	(10, 10, 24, '01:06:00', '01:05:00'),
	(10, 10, 1,   NULL     , '01:15:00');

-- таблица станций на маршруте


INSERT INTO RouteStations (route_id, station_id, station_order, price_to_next_station)
VALUES
  -- Маршрут 1: Зеленоград-Крюково -> Москва Ленинградская (комфорт)
  (1, 1, 1, 50.00),
	(1, 24, 2, 50.00),
	(1, 25, 3, 50.00),
	(1, 26, 4, 50.00),
	(1, 27, 5, 50.00),
	(1, 28, 6, 50.00),
  (1, 29, 7, 50.00),
	(1, 30, 8, 50.00),
  (1, 31, 9, 30.00),
	(1, 32, 10, 50.00),
  (1, 33, 11, 25.00),
  (1, 34, 12, 15.00),
	(1, 35, 13, 30.00),
	(1, 36, 14, 40.00),
	(1, 38, 15, 0.00),

  -- Маршрут 2: Клин -> Москва Ленинградская (комфорт)
  (2, 12, 1, 60.00),
	(2, 39, 2, 60.00),
	(2, 14, 3, 60.00),
	(2, 15, 4, 60.00),
	(2, 16, 5, 60.00),
	(2, 17, 6, 60.00),
	(2, 18, 7, 60.00),
	(2, 19, 8, 60.00),
	(2, 20, 9, 60.00),
	(2, 21, 10, 60.00),
	(2, 1, 11, 60.00),
	(2, 24, 12, 60.00),
	(2, 25, 13, 60.00),
  (2, 26, 14, 50.00),
  (2, 27, 15, 45.00),
  (2, 28, 16, 40.00),
  (2, 29, 17, 30.00),
  (2, 30, 18, 25.00),
  (2, 38, 19, 0.00),

  -- Маршрут 3: Зеленоград-Крюково -> Москва Ленинградская (комфорт)
  (3, 1, 1, 25.00),
  (3, 25, 2, 30.00),
  (3, 29, 3, 40.00),
  (3, 38, 4, 0.00),

  -- Маршрут 4: Тверь -> Москва Ленинградская (Пригородный)

	(4, 2, 1, 20.00),
	(4, 3, 2, 30.00),
	(4, 4, 3, 40.00),
	(4, 5, 4, 50.00),
	(4, 6, 5, 50.00),
	(4, 7, 6, 30.00),
	(4, 8, 7, 30.00),
	(4, 9, 8, 20.00),
	(4, 10, 9, 30.00),
	(4, 11, 10, 20.00),
	(4, 12, 11, 30.00),
	(4, 13, 12, 40.00),
	(4, 39, 13, 20.00),
	(4, 14, 14, 20.00),
	(4, 15, 15, 50.00),
	(4, 16, 16, 20.00),
	(4, 17, 17, 20.00),
	(4, 18, 18, 30.00),
	(4, 19, 19, 30.00),
	(4, 20, 20, 40.00),
	(4, 21, 21, 30.00),
	(4, 1, 22, 20.00),
	(4, 24, 23, 20.00),
	(4, 25, 24, 10.00),
	(4, 26, 25, 20.00),
	(4, 27, 26, 30.00),
	(4, 28, 27, 20.00),
	(4, 29, 28, 30.00),
	(4, 30, 29, 30.00),
	(4, 31, 30, 40.00),
	(4, 32, 31, 50.00),
	(4, 33, 32, 20.00),
	(4, 34, 33, 20.00),
	(4, 35, 34, 15.00),
	(4, 36, 35, 20.00),
	(4, 38, 36, 0.00),

 -- Маршрут 5: Клин -> Москва Ленинградская (комфорт)
 	 (5, 12, 1, 20.00),
	 (5, 13, 2, 20.00),
	 (5, 39, 3, 20.00),
	 (5, 14, 4, 20.00),
	 (5, 15, 5, 20.00),
	 (5, 16, 6, 20.00),
	 (5, 17, 7, 20.00),
	 (5, 18, 8, 20.00),
	 (5, 19, 9, 20.00),
	 (5, 20, 10, 20.00),
	 (5, 1, 11, 20.00),
	 (5, 24, 12, 20.00),
	 (5, 25, 13, 20.00),
	 (5, 26, 14, 20.00),
	 (5, 27, 15, 20.00),
	 (5, 28, 16, 20.00),
	 (5, 29, 17, 20.00),
	 (5, 30, 18, 20.00),
	 (5, 31, 19, 20.00),
	 (5, 32, 20, 20.00),
	 (5, 32, 21, 20.00),
	 (5, 33, 22, 20.00),
	 (5, 34, 23, 20.00),
	 (5, 35, 24, 20.00),
	 (5, 36, 25, 20.00),
	 (5, 38, 26, 20.00),

    -- Маршрут 6: Москва Ленинградская -> Подсолнечное (Комфорт)
    (6, 38, 1, 25.00),
	(6, 36, 2, 25.00),
	(6, 35, 3, 25.00),
	(6, 34, 4, 25.00),
	(6, 33, 5, 25.00),
	(6, 32, 6, 25.00),
	(6, 31, 7, 25.00),
	(6, 30, 8, 25.00),
	(6, 29, 9, 25.00),
	(6, 28, 10, 25.00),
	(6, 27, 11, 25.00),
	(6, 26, 12, 25.00),
	(6, 25, 13, 25.00),
	(6, 24, 14, 25.00),
	(6, 1,  15, 25.00),
	(6, 22, 16, 25.00),
	(6, 21, 17, 25.00),
	(6, 20, 18, 25.00),
    (6, 19, 19, 30.00),
    (6, 18, 20, 40.00),
    (6, 17, 21, 0.00),

	-- Маршрут 7: Клин -> Москва Ленинградская (Ласточка)
	(7, 12, 1, 25.00),
	(7, 17, 2, 25.00),
	(7, 19, 3, 40.00),
	(7, 1, 4, 25.00),
	(7, 25, 5, 30.00),
	(7, 29, 6, 25.00),
	(7, 38, 7, 0.00),

	-- Маршрут 8: Москва Ленинградская -> Тверь (Ласточка)
	(8, 38, 1, 25.00),
	(8, 29, 2, 25.00),
	(8, 25, 3, 40.00),
	(8, 1, 4, 25.00),
	(8, 17, 5, 30.00),
	(8, 12, 6, 50.00),
	(8, 10, 7, 45.00),
	(8, 8, 8, 40.00),
	(8, 6, 9, 35.00),
	(8, 3, 10, 15.00),
	(8, 2, 11, 0.00),

	-- Маршрут 9: Москва Ленинградская -> Клин (Комфорт)
	(9, 38, 1, 25.00),
	(9, 29, 2, 25.00),
	(9, 25, 3, 40.00),
	(9, 1, 4, 25.00),
	(9, 22, 5, 30.00),
	(9, 20, 6, 50.00),
	(9, 19, 7, 45.00),
	(9, 18, 8, 40.00),
	(9, 17, 9, 35.00),
	(9, 16, 10, 15.00),
	(9, 15, 11, 35.00),
	(9, 14, 12, 25.00),
	(9, 39, 13, 45.00),
	(9, 13, 14, 25.00),
	(9, 12, 15, 0.00),
	-- Маршрут 10: Москва Ленинградская -> Зеленоград-Крюково (Комфорт)
	(10, 38, 1, 25.00),
	(10, 36, 2, 25.00),
	(10, 35, 3, 40.00),
	(10, 34, 4, 25.00),
	(10, 33, 5, 30.00),
	(10, 32, 6, 30.00),
	(10, 31, 7, 35.00),
	(10, 30, 8, 30.00),
	(10, 29, 9, 35.00),
	(10, 28, 10, 15.00),
	(10, 27, 11, 35.00),
	(10, 26, 12, 15.00),
	(10, 25, 13, 25.00),
	(10, 24, 14, 15.00),
	(10, 1, 15, 0.00);

-- таблица пути


INSERT INTO Routes (start_station_id, end_station_id, estimated_time, description)
VALUES
    (1,  38, '01:03:00', 'Зеленоград-Крюково, пл.Фирсановская, Сходня, пл.Подрезково, пл.Новоподрезково, пл.Молжаниново, Химки, пл.Левобережная, пл.Ховрино, Грачевская, пл.Моссельмаш, пл.Лихоборы, пл.Петровско-Разумовская,пл.Останкино, Москва Ленинградская'),
    (12, 38, '00:51:00', 'Клин, пл.Фроловское, пл.Покровка, пл.Головково, пл.Сенеж, Подсолненчная, пл.Березки-Дачные, Поворово-1, пл.Поваровка, пл.Радищево, Зеленоград-Крюково, пл.Фирсановская, Сходня, пл.Подрезково, пл.Новоподрезково, пл.Молжаниново, Химки, пл.Левобережная, Москва Ленинградская'),
    (1,  38, '00:35:00', 'Зеленоград, Сходня, Химки, Москва Ленинградская'),
    (2,  38, '01:03:00', 'Все остановки кроме: пл.Алабушево, пл.Малино, пл.Рижская'),
    (12, 38, '01:07:00', 'Все остановки кроме: пл.Радищево, пл.Малино, пл.Рижская'),
    (1,  38, '00:33:00', 'Зеленоград-Крюково, Сходня, Химки, Москва Ленинградская'),
    (12, 38, '00:34:00', 'Клин, Подсолнечная, Поварово-1, Зеленоград-Крюково, Сходня, Химки, Москва Ленинградская'),
    (38,  1, '00:28:00', 'Москва Ленинградская, Химки, Сходня,Зеленоград-Крюково, Подсолнечная, Клин, Решетниково, Завидово, Редкино, пл.Чуприяновка, Тверь'),
    (38, 12, '00:36:00', 'Москва Ленинградская, Химки, Сходня, Зеленоград-Крюково, пл.Алабушево, пл.Поваровка, Поварово-1, пл.Березки-Дачные, Подсолнечная, пл.Сенеж, пл.Головково, пл.Покровка, пл.Фроловское, пл.Стреглово, Клин'),
    (38,  1, '00:58:00', 'Все остановки кроме: пл.Рижская, пл.Малино');

-- таблица станции


INSERT INTO Stations (station_name, train_platform_amount, self_checkout)
VALUES
('Зеленоград', 4, TRUE),
('Тверь', 4, TRUE),
('Пл. Чуприняновка', 2, TRUE),
('Пл. Кузьминка', 2, TRUE),
('Пл. Межево', 2, FALSE),
('Редкино', 2, TRUE),
('Пл. Московское море', 2, FALSE),
('Завидово', 2, TRUE),
('Пл. Черничная', 2, FALSE),
('Решетниково', 2, TRUE),
('Пл. Ямуга', 2, FALSE),
('Клин', 2, TRUE),
('пл. Стреглово',  2, FALSE),
('пл. Покровка',  2, FALSE),
('пл. Головково',  2, FALSE),
('пл. Сенеж',  2, FALSE),
('Подсолнечная', 2, TRUE),
('пл. Березки-Дачные',  2, FALSE),
('Поварово-1', 2, TRUE),
('пл. Поваровка',  2, FALSE),
('пл. Радищево',  2, FALSE),
('пл. Алабушево',  2, FALSE),
('пл. Малино',  2, FALSE),
('пл. Фирсановская',  2, FALSE),
('Сходня',  2, TRUE),
('пл. Подрезково',  2, FALSE),
('пл. Новоподрезково',  2, FALSE),
('пл. Молжаниново',  2, FALSE),
('Химки',  3, TRUE),
('пл. Левобережная',  2, FALSE),
('пл. Ховрино',  2, FALSE),
('Грачёвская', 2, FALSE),
('пл. Моссельмаш',  2, FALSE),
('пл. Лихоборы',  2, FALSE),
('пл. Петровско-Разумовская',  2, FALSE),
('пл. Останкино',  2, FALSE),
('пл. Рижская',  2, FALSE),
('Москва Ленинградская',  9, TRUE);

-- таблица пользователе

INSERT INTO Users ( first_name, last_name, mail, phone_number,money,user_password,transport_concession)
VALUES
('Афелий','прерправ', '123', '8-915-696-45-36', 12312,'123','без льгот');

```
